library(gbm)
setwd("C:/Users/MANISH/Documents/Work/Click Fraud Detection/Algorithm/Datasets/click-fraud-data")

trainingset=read.csv("TrainingParams.csv")
gbm1 <- gbm(Status3 ~ country_sa + country_af + country_al + country_am + country_az + country_bd + country_be + country_bh + country_br + country_cz + country_dz + country_eg + country_et + country_gh + country_id + country_in + country_jo + country_ke + country_my + country_ng + country_np + country_ph + country_pl + country_ro + country_ru + country_tr + country_tz + country_ua + country_uk + country_us + country_zw + country_ae + country_ar + country_bn + country_bo + country_ec + country_es + country_gt + country_lk + country_mx + country_nl + country_rs + country_sg + country_sv + country_tw + country_ve + country_za + country_au + country_bj + country_ca + country_gr + country_hk + country_kw + country_mt + country_no + country_rw + country_sl + country_vn + country_ao + country_cn + country_hu + country_ir + country_it + country_lt + country_ma + country_mw + country_mz + country_na + country_pk + country_qa + country_se + country_zm + country_bw + country_ge + country_jp + country_sk + country_th + country_de + country_dj + country_fr + country_mu + country_eu + country_om + country_sd + country_sz + country_cl + country_ie + country_jm + country_iq + country_ly + country_hr + country_kr + country_la + country_lr + country_mv + country_tl + country_ye + clicksbyhour_Night_N + clicksbyhour_Night_MEAN + clicksbyhour_Night_STD + clicksbyhour_Overall_N + clicksbyhour_Overall_MEAN + clicksbyhour_Overall_STD + clicksbyhour_Evening_N + clicksbyhour_Evening_MEAN + clicksbyhour_Evening_STD + clicksbyhour_Afterno_N + clicksbyhour_Afterno_MEAN + clicksbyhour_Afterno_STD + clicksbyhour_Morning_N + clicksbyhour_Morning_MEAN + clicksbyhour_Morning_STD + clicksbyhour_Overall_sum + clicksbyhour_afterno_sum + clicksbyhour_evening_sum + clicksbyhour_morning_sum + clicksbyhour_night_sum + concatid_Night_N + concatid_Night_MEAN + concatid_Night_STD + concatid_Overall_N + concatid_Overall_MEAN + concatid_Overall_STD + concatid_Evening_N + concatid_Evening_MEAN + concatid_Evening_STD + concatid_Afterno_N + concatid_Afterno_MEAN + concatid_Afterno_STD + concatid_Morning_N + concatid_Morning_MEAN + concatid_Morning_STD + concatid_Overall_sum + concatid_afterno_sum + concatid_evening_sum + concatid_morning_sum + concatid_night_sum + ip_Night_N + ip_Night_MEAN + ip_Night_STD + ip_Overall_N + ip_Overall_MEAN + ip_Overall_STD + ip_Evening_N + ip_Evening_MEAN + ip_Evening_STD + ip_Afterno_N + ip_Afterno_MEAN + ip_Afterno_STD + ip_Morning_N + ip_Morning_MEAN + ip_Morning_STD + ip_Overall_sum + ip_afterno_sum + ip_evening_sum + ip_morning_sum + ip_night_sum + agent_Night_N + agent_Night_MEAN + agent_Night_STD + agent_Overall_N + agent_Overall_MEAN + agent_Overall_STD + agent_Evening_N + agent_Evening_MEAN + agent_Evening_STD + agent_Afterno_N + agent_Afterno_MEAN + agent_Afterno_STD + agent_Morning_N + agent_Morning_MEAN + agent_Morning_STD + agent_Overall_sum + agent_afterno_sum + agent_evening_sum + agent_morning_sum + agent_night_sum + ref_Night_N + ref_Night_MEAN + ref_Night_STD + ref_Overall_N + ref_Overall_MEAN + ref_Overall_STD + ref_Evening_N + ref_Evening_MEAN + ref_Evening_STD + ref_Afterno_N + ref_Afterno_MEAN + ref_Afterno_STD + ref_Morning_N + ref_Morning_MEAN + ref_Morning_STD + ref_Overall_sum + ref_afterno_sum + ref_evening_sum + ref_morning_sum + ref_night_sum + cid_Night_N + cid_Night_MEAN + cid_Night_STD + cid_Overall_N + cid_Overall_MEAN + cid_Overall_STD + cid_Evening_N + cid_Evening_MEAN + cid_Evening_STD + cid_Afterno_N + cid_Afterno_MEAN + cid_Afterno_STD + cid_Morning_N + cid_Morning_MEAN + cid_Morning_STD + cid_Overall_sum + cid_afterno_sum + cid_evening_sum + cid_morning_sum + cid_night_sum, data=trainingset, distribution = "bernoulli", n.trees=5000, shrinkage=0.001, interaction.depth=5, n.minobsinnode=5)
best.iter=gbm.perf(gbm1,method="OOB")
summary(gbm1,trees=best.iter)
plot.gbm(gbm1,5,best.iter)


testset=read.csv("TestParams.csv")
testresult <- predict.gbm(gbm1,testset,best.iter)
range(testresult)
hist(testresult)
write.csv(testresult,"results.csv")